<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Load-In Animation Test — Boet Materials</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #f5f2ee;
  --dark: #0c0a09;
  --accent: #9E1B32;
  --green: #22c55e;
  --green-muted: #16a34a;
  --text-name: #1a1714;
  --text-ticker: #8a7e70;
  --font-heading: 'Outfit', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}

html, body { height: 100%; overflow: hidden; }

body {
  font-family: var(--font-heading);
  background: var(--dark);
  color: #f2ede8;
  -webkit-font-smoothing: antialiased;
}

/* ── Page underneath ── */
.page-content {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  z-index: 1;
  background-image: url('photo-industrial-1-desktop.jpg');
  background-size: cover;
  background-position: center;
}
.page-content::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(160deg, rgba(12,10,9,0.88), rgba(12,10,9,0.6));
}
.page-inner {
  position: relative;
  z-index: 2;
  text-align: left;
  padding: 60px;
  max-width: 800px;
}
.page-inner h1 {
  font-family: var(--font-heading);
  font-weight: 900;
  font-size: clamp(38px, 6vw, 72px);
  text-transform: uppercase;
  line-height: 1.06;
  margin-bottom: 20px;
}
.page-inner p {
  color: rgba(255,255,255,0.55);
  font-size: 18px;
  line-height: 1.7;
  max-width: 560px;
}

/* ── Overlay layers ── */
.overlay-bg {
  position: fixed;
  inset: 0;
  z-index: 9998;
  background: var(--bg);
}

.overlay-text {
  position: fixed;
  inset: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  user-select: none;
  background: var(--bg);
  transition: opacity 0.2s ease;
}
.overlay-text.fading { opacity: 0; }

/* ── Logo container ── */
.logo-container {
  position: relative;
  width: clamp(280px, 50vw, 520px);
  margin: 0 auto 0;
}
.logo-svg {
  display: block;
  width: 100%;
  height: auto;
}

/* ── B letter pieces ── */
.b-piece {
  opacity: 0;
  transition: opacity 0.4s cubic-bezier(0.25,0.1,0.25,1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
}
.b-bar    { transform: translateY(20px); }
.b-top    { transform: translateX(30px) translateY(-10px); opacity: 0; }
.b-bottom { transform: translateX(30px) translateY(10px); opacity: 0; }

.b-piece.visible {
  opacity: 1;
  transform: translate(0, 0);
}

/* ── OET letters ── */
.logo-oet {
  opacity: 0;
  clip-path: inset(0 100% 0 0);
  transition: clip-path 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
}
.logo-oet.visible {
  opacity: 1;
  clip-path: inset(0 0% 0 0);
}

/* ── MATERIALS letters ── */
.logo-materials {
  opacity: 0;
  clip-path: inset(0 100% 0 0);
  transition: clip-path 0.7s cubic-bezier(0.16, 1, 0.3, 1) 0.1s, opacity 0.3s ease 0.1s;
}
.logo-materials.visible {
  opacity: 1;
  clip-path: inset(0 0% 0 0);
}

/* ── B centered phase ── */
.logo-b-group {
  transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

/* ── Accent line ── */
.accent-line {
  width: 28px;
  height: 2px;
  background: var(--accent);
  border-radius: 1px;
  margin: 16px auto 14px;
  transform: scaleX(0);
  transition: transform 0.3s cubic-bezier(0.25,0.1,0.25,1) 0.2s;
}
.accent-line.visible { transform: scaleX(1); }

/* ── Exchange label ── */
.exchange-label {
  font-family: var(--font-mono);
  font-size: clamp(10px, 1vw, 12px);
  letter-spacing: 0.3em;
  text-transform: uppercase;
  color: var(--text-ticker);
  margin-bottom: 10px;
  opacity: 0;
  transition: opacity 0.3s ease 0.25s;
}
.exchange-label.visible { opacity: 1; }

/* ── Stock price (odometer) ── */
.stock-price {
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: clamp(32px, 5vw, 56px);
  color: var(--text-name);
  line-height: 1;
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 0;
  min-height: 1.15em;
}

/* ── Odometer character ── */
.odo-char {
  display: inline-block;
  overflow: hidden;
  height: 1.15em;
  vertical-align: bottom;
  position: relative;
}
.odo-char-static {
  display: inline-block;
  height: 1.15em;
  line-height: 1.15em;
}
.odo-strip {
  display: flex;
  flex-direction: column;
  transition: transform 0.6s cubic-bezier(0.33, 1, 0.68, 1);
}
.odo-strip span {
  display: block;
  height: 1.15em;
  line-height: 1.15em;
  text-align: center;
}

/* ── Day change ── */
.day-change {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 8px;
  font-family: var(--font-mono);
  font-size: clamp(12px, 1.3vw, 15px);
  font-weight: 600;
  color: var(--green);
  opacity: 0;
  transform: translateY(6px);
  transition: opacity 0.35s ease, transform 0.35s cubic-bezier(0.25,0.1,0.25,1);
}
.day-change.visible { opacity: 1; transform: translateY(0); }
.day-change .arrow-up {
  display: inline-block;
  font-size: 0.8em;
  margin-right: 2px;
}

/* ── Block grid ── */
.block-container {
  position: fixed;
  inset: 0;
  z-index: 9999;
  overflow: hidden;
  pointer-events: none;
}
.grid-block {
  position: absolute;
  background: var(--bg);
  will-change: transform;
}

/* ── Replay button ── */
.replay-btn {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 20000;
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: #fff;
  background: var(--accent);
  border: none;
  padding: 12px 24px;
  border-radius: 4px;
  cursor: pointer;
  pointer-events: auto;
  transition: background 0.2s ease;
}
.replay-btn:hover { background: #b42240; }

@media (prefers-reduced-motion: reduce) {
  .overlay-text, .b-piece, .logo-oet, .logo-materials, .logo-b-group,
  .accent-line, .exchange-label, .day-change, .odo-strip, .grid-block {
    transition-duration: 0.01ms !important;
  }
}
</style>
</head>
<body>

<!-- Page content (revealed after blocks drop) -->
<main class="page-content">
  <div class="page-inner">
    <p style="font-family: var(--font-mono); font-size: 11px; letter-spacing: 3px; color: #9E1B32; margin-bottom: 20px;">CRITICAL MINERALS FOR THE ENERGY TRANSITION</p>
    <h1>Pioneering the Future of Advanced Materials</h1>
    <p>A next-generation critical minerals company built for the energy transition.</p>
  </div>
</main>

<!-- Overlay: solid background -->
<div class="overlay-bg" id="overlayBg"></div>

<!-- Overlay: text layer -->
<div class="overlay-text" id="overlayText">
  <div style="text-align:center; padding: 24px;">

    <!-- ── SVG Logo with animated groups ── -->
    <div class="logo-container" id="logoContainer">
      <svg class="logo-svg" id="logoSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 647.28 45.33">
        <!-- B letter — 3 geometric pieces -->
        <g class="logo-b-group" id="bGroup">
          <polygon class="b-piece b-bar" id="bBar" points="0 .8 0 44.53 11.32 44.53 11.32 9.46 32.96 9.68 22.19 .8 0 .8" fill="#9f1c34"/>
          <polygon class="b-piece b-top" id="bTop" points="43.62 18.23 32.96 27.11 11.32 27.11 32.96 9.68 43.62 18.23" fill="#9f1c34"/>
          <polygon class="b-piece b-bottom" id="bBottom" points="43.62 35.65 32.96 44.53 11.32 44.53 32.96 27.11 43.62 35.65" fill="#9f1c34"/>
        </g>

        <!-- OET letters -->
        <g class="logo-oet" id="logoOet">
          <path d="M75.47,35.49c2.46,0,4.59-.53,6.41-1.6,1.81-1.07,3.22-2.57,4.21-4.51.99-1.94,1.49-4.2,1.49-6.78,0-1.92-.28-3.66-.85-5.23-.57-1.56-1.38-2.91-2.45-4.04-1.07-1.13-2.34-2-3.82-2.6-1.48-.6-3.14-.9-4.98-.9-2.45,0-4.58.52-6.39,1.57-1.81,1.05-3.22,2.53-4.21,4.45-.99,1.92-1.49,4.17-1.49,6.75,0,1.95.28,3.72.85,5.31.57,1.59,1.38,2.95,2.44,4.07,1.06,1.13,2.34,1.99,3.82,2.6,1.49.61,3.14.91,4.97.91ZM75.59,45.33c-3.36,0-6.46-.58-9.31-1.73-2.84-1.15-5.32-2.75-7.45-4.8-2.12-2.05-3.77-4.46-4.95-7.23-1.18-2.77-1.77-5.76-1.77-8.97s.58-6.22,1.74-8.96c1.16-2.73,2.79-5.13,4.9-7.18,2.1-2.05,4.57-3.64,7.41-4.77,2.84-1.13,5.94-1.7,9.3-1.7s6.46.57,9.3,1.7c2.84,1.13,5.31,2.72,7.42,4.77,2.11,2.05,3.74,4.45,4.9,7.21,1.16,2.75,1.74,5.75,1.74,8.99s-.58,6.19-1.74,8.94c-1.16,2.75-2.79,5.16-4.9,7.22-2.1,2.06-4.56,3.66-7.39,4.8s-5.89,1.7-9.21,1.7Z" fill="#1a1714"/>
          <path d="M122.62,10.1V.8h23.36v9.3h-23.36ZM122.62,26.75v-9.05h21.48v9.05h-21.48ZM122.62,44.53v-9.3h23.71v9.3h-23.71ZM113.91,44.53V.8h11.02v43.73h-11.02Z" fill="#1a1714"/>
          <path d="M158.08,10.28V.8h37.81v9.48h-37.81ZM171.45,44.53V1.11h11.02v43.42h-11.02Z" fill="#1a1714"/>
        </g>

        <!-- MATERIALS letters -->
        <g class="logo-materials" id="logoMaterials">
          <polygon points="230.34 44.53 230.34 .8 238.28 .8 255.03 26.13 251.31 26.13 268.01 .8 275.95 .8 275.95 44.53 265.02 44.53 265.02 19.09 266.76 19.57 256.73 34.66 249.57 34.66 239.58 19.57 241.28 19.09 241.28 44.53 230.34 44.53" fill="#9f1c34"/>
          <path d="M300.32,36.9v-8.76h24.13v8.76h-24.13ZM289.99,44.53L306.97.8h10.67l16.81,43.73h-11.53l-12.66-36.73h3.98l-12.92,36.73h-11.32Z" fill="#9f1c34"/>
          <path d="M340.62,10.28V.8h37.81v9.48h-37.81ZM353.99,44.53V1.11h11.02v43.42h-11.02Z" fill="#9f1c34"/>
          <path d="M401.64,10.1V.8h23.36v9.3h-23.36ZM401.64,26.75v-9.05h21.48v9.05h-21.48ZM401.64,44.53v-9.3h23.71v9.3h-23.71ZM392.93,44.53V.8h11.02v43.73h-11.02Z" fill="#9f1c34"/>
          <path d="M464.77,44.53l-12.75-18.75,9.98-2.41,15.51,21.16h-12.74ZM441.08,44.53V.8h11.02v43.73h-11.02ZM449.8,26.81v-7.85h8.33c1.81,0,3.2-.45,4.16-1.35.97-.9,1.45-2.11,1.45-3.63s-.48-2.67-1.44-3.59c-.96-.93-2.35-1.39-4.16-1.39h-8.34V.8h9.9c2.96,0,5.56.55,7.8,1.66,2.24,1.11,4,2.63,5.27,4.58,1.27,1.95,1.9,4.21,1.9,6.78s-.64,4.87-1.93,6.82c-1.28,1.94-3.08,3.46-5.38,4.55-2.3,1.09-5.01,1.63-8.13,1.63h-9.44Z" fill="#9f1c34"/>
          <rect x="490.6" y=".8" width="11.02" height="43.73" fill="#9f1c34"/>
          <path d="M525.98,36.9v-8.76h24.13v8.76h-24.13ZM515.65,44.53L532.62.8h10.67l16.81,43.73h-11.53l-12.66-36.73h3.98l-12.92,36.73h-11.32Z" fill="#9f1c34"/>
          <path d="M582.42,44.53v-9.48h21.05v9.48h-21.05ZM573.66,44.53V.8h11.02v43.73h-11.02Z" fill="#9f1c34"/>
          <path d="M629.79,45.24c-3.66,0-6.83-.56-9.51-1.69-2.68-1.13-5.13-2.88-7.36-5.27l6.98-6.99c1.5,1.57,3.12,2.78,4.86,3.62,1.74.84,3.68,1.26,5.83,1.26,1.86,0,3.29-.32,4.29-.95,1-.63,1.5-1.5,1.5-2.61,0-1.04-.37-1.89-1.11-2.57-.74-.67-1.72-1.26-2.93-1.77-1.21-.5-2.55-1-4.01-1.49-1.46-.49-2.91-1.07-4.36-1.74-1.44-.67-2.77-1.5-3.99-2.48-1.21-.98-2.19-2.21-2.93-3.7-.74-1.49-1.11-3.32-1.11-5.51,0-2.76.67-5.14,2-7.13,1.33-1.99,3.19-3.51,5.57-4.56,2.38-1.05,5.16-1.58,8.31-1.58s6.1.53,8.77,1.6c2.67,1.06,4.88,2.54,6.61,4.42l-7.03,6.98c-1.33-1.34-2.66-2.33-4.02-2.98-1.35-.65-2.84-.97-4.48-.97-1.49,0-2.67.26-3.55.79-.87.52-1.31,1.29-1.31,2.3s.37,1.77,1.11,2.39c.74.62,1.72,1.16,2.93,1.64,1.21.48,2.55.96,4.01,1.46,1.46.49,2.91,1.07,4.36,1.73,1.44.66,2.77,1.51,3.99,2.54,1.21,1.03,2.19,2.32,2.93,3.87.74,1.55,1.11,3.45,1.11,5.69,0,4.33-1.54,7.69-4.61,10.09-3.07,2.4-7.37,3.6-12.87,3.6Z" fill="#9f1c34"/>
        </g>
      </svg>
    </div>

    <div class="accent-line" id="accentLine"></div>
    <div class="exchange-label" id="exchangeLabel">TSXV: AUM</div>
    <div class="stock-price" id="stockPrice"></div>
    <div class="day-change" id="dayChange">
      <span><span class="arrow-up">&#9650;</span> +$0.18</span>
      <span>(+5.56%)</span>
    </div>
  </div>
</div>

<!-- Block container (populated by JS) -->
<div class="block-container" id="blockContainer" style="display:none;"></div>

<!-- Replay button -->
<button class="replay-btn" id="replayBtn" style="display:none;">Replay Animation</button>

<script>
(function() {
  /* ═══════════════════════════════════════════════════ */
  /* Configuration                                       */
  /* ═══════════════════════════════════════════════════ */
  const STOCK_PRICE    = '$3.42';
  const BG_COLOR       = '#f5f2ee';

  /* Odometer settings */
  const DIGIT_POOL     = '0123456789';
  const STRIP_LENGTH   = 8;
  const CHAR_HEIGHT    = 1.15;

  /* ═══════════════════════════════════════════════════ */
  /* Timing (ms)                                         */
  /* ═══════════════════════════════════════════════════ */
  const B_ASSEMBLE_START  = 200;   // when B pieces start appearing
  const B_PIECE_STAGGER   = 120;   // delay between each B piece
  const B_SETTLE_HOLD     = 400;   // pause after B is assembled
  const LOGO_REVEAL_DUR   = 600;   // OET + MATERIALS reveal
  const POST_LOGO_HOLD    = 300;   // pause after full logo is visible
  const ODO_STAGGER       = 70;
  const ODO_DURATION      = 600;
  const POST_PRICE_HOLD   = 150;
  const DAY_CHANGE_HOLD   = 600;
  const TEXT_FADE          = 200;
  const BLOCK_STAGGER     = 30;
  const BLOCK_DURATION    = 450;

  /* ═══════════════════════════════════════════════════ */
  /* DOM refs                                            */
  /* ═══════════════════════════════════════════════════ */
  const overlayBg      = document.getElementById('overlayBg');
  const overlayText    = document.getElementById('overlayText');
  const bGroup         = document.getElementById('bGroup');
  const bBar           = document.getElementById('bBar');
  const bTop           = document.getElementById('bTop');
  const bBottom        = document.getElementById('bBottom');
  const logoOet        = document.getElementById('logoOet');
  const logoMaterials  = document.getElementById('logoMaterials');
  const accentLine     = document.getElementById('accentLine');
  const exchangeLabel  = document.getElementById('exchangeLabel');
  const stockPrice     = document.getElementById('stockPrice');
  const dayChange      = document.getElementById('dayChange');
  const blockContainer = document.getElementById('blockContainer');
  const replayBtn      = document.getElementById('replayBtn');
  const logoSvg        = document.getElementById('logoSvg');

  /* ═══════════════════════════════════════════════════ */
  /* B centering math                                    */
  /* ═══════════════════════════════════════════════════ */
  // The B occupies roughly x: 0–43.62 in the 647.28-wide viewBox
  // Center of the full SVG is 323.64, center of B is ~21.81
  // Offset to center B: 323.64 - 21.81 = 301.83
  const B_CENTER_OFFSET = 301.83;

  /* ═══════════════════════════════════════════════════ */
  /* Grid helpers                                        */
  /* ═══════════════════════════════════════════════════ */
  function getColCount(w) {
    if (w < 640)  return 8;
    if (w < 1024) return 12;
    return 16;
  }

  /* ═══════════════════════════════════════════════════ */
  /* Build stock-price odometer                          */
  /* ═══════════════════════════════════════════════════ */
  function buildPriceOdometer() {
    stockPrice.innerHTML = '';
    const chars = STOCK_PRICE.split('');
    const odoElements = [];
    let digitIndex = 0;

    chars.forEach((char) => {
      const isDigit = /[0-9]/.test(char);
      if (!isDigit) {
        const el = document.createElement('span');
        el.className = 'odo-char-static';
        el.textContent = char;
        stockPrice.appendChild(el);
      } else {
        const wrapper = document.createElement('span');
        wrapper.className = 'odo-char';
        const strip = document.createElement('span');
        strip.className = 'odo-strip';
        for (let j = 0; j < STRIP_LENGTH; j++) {
          const s = document.createElement('span');
          s.textContent = DIGIT_POOL[Math.floor(Math.random() * 10)];
          strip.appendChild(s);
        }
        const target = document.createElement('span');
        target.textContent = char;
        strip.appendChild(target);
        wrapper.appendChild(strip);
        stockPrice.appendChild(wrapper);
        odoElements.push({ strip, digitIndex });
        digitIndex++;
      }
    });
    return odoElements;
  }

  /* ═══════════════════════════════════════════════════ */
  /* Build block grid                                    */
  /* ═══════════════════════════════════════════════════ */
  function buildBlocks() {
    const w = window.innerWidth;
    const h = window.innerHeight;
    const cols = getColCount(w);
    const blockW = Math.ceil(w / cols);
    const blockH = blockW;
    const rows = Math.ceil(h / blockH) + 1;

    blockContainer.innerHTML = '';
    const blocks = [];

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const div = document.createElement('div');
        div.className = 'grid-block';
        div.style.left   = (c * blockW) + 'px';
        div.style.top    = (r * blockH) + 'px';
        div.style.width  = (blockW + 1) + 'px';
        div.style.height = (blockH + 1) + 'px';
        div.style.transform  = 'translateY(0)';
        div.style.transition = 'none';
        blockContainer.appendChild(div);
        blocks.push({ el: div, r, c, delay: (r + c) * BLOCK_STAGGER });
      }
    }

    return {
      blocks,
      maxDelay: ((rows - 1) + (cols - 1)) * BLOCK_STAGGER,
      vh: h,
      blockH,
    };
  }

  /* ═══════════════════════════════════════════════════ */
  /* Run the full animation                              */
  /* ═══════════════════════════════════════════════════ */
  function runAnimation() {
    /* ── Reset everything ── */
    overlayBg.style.display   = '';
    overlayText.style.display = '';
    overlayText.style.opacity = '';
    overlayText.classList.remove('fading');

    // Reset B pieces
    bBar.classList.remove('visible');
    bTop.classList.remove('visible');
    bBottom.classList.remove('visible');
    bBar.style.opacity = '0';
    bTop.style.opacity = '0';
    bBottom.style.opacity = '0';

    // Start B centered
    bGroup.style.transition = 'none';
    bGroup.style.transform = 'translate(' + B_CENTER_OFFSET + 'px, 0)';

    // Hide rest of logo
    logoOet.classList.remove('visible');
    logoOet.style.opacity = '0';
    logoMaterials.classList.remove('visible');
    logoMaterials.style.opacity = '0';

    accentLine.classList.remove('visible');
    exchangeLabel.classList.remove('visible');
    stockPrice.innerHTML = '';
    dayChange.classList.remove('visible');
    blockContainer.style.display = 'none';
    blockContainer.innerHTML     = '';
    replayBtn.style.display      = 'none';
    document.body.style.overflow = 'hidden';

    /* ── Phase 1: B assembles (centered) ── */
    setTimeout(() => {
      // Vertical bar drops in
      bBar.style.opacity = '';
      bBar.classList.add('visible');

      // Top chevron snaps in
      setTimeout(() => {
        bTop.style.opacity = '';
        bTop.classList.add('visible');
      }, B_PIECE_STAGGER);

      // Bottom chevron snaps in
      setTimeout(() => {
        bBottom.style.opacity = '';
        bBottom.classList.add('visible');
      }, B_PIECE_STAGGER * 2);

    }, B_ASSEMBLE_START);

    /* ── Phase 2: B slides left, rest of logo reveals ── */
    const slideStart = B_ASSEMBLE_START + (B_PIECE_STAGGER * 2) + B_SETTLE_HOLD;

    setTimeout(() => {
      // Slide B to its home position
      bGroup.style.transition = 'transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)';
      bGroup.style.transform = 'translate(0, 0)';

      // Reveal OET
      setTimeout(() => {
        logoOet.style.opacity = '';
        logoOet.classList.add('visible');
      }, 150);

      // Reveal MATERIALS
      setTimeout(() => {
        logoMaterials.style.opacity = '';
        logoMaterials.classList.add('visible');
      }, 250);

      // Show accent line + exchange label
      setTimeout(() => {
        accentLine.classList.add('visible');
        exchangeLabel.classList.add('visible');
      }, 400);

    }, slideStart);

    /* ── Phase 3: Stock price odometer roll ── */
    const odoStart = slideStart + LOGO_REVEAL_DUR + POST_LOGO_HOLD;

    setTimeout(() => {
      const odoElements = buildPriceOdometer();
      stockPrice.offsetHeight;

      odoElements.forEach(({ strip, digitIndex }) => {
        setTimeout(() => {
          const scrollY = -(STRIP_LENGTH * CHAR_HEIGHT);
          strip.style.transform = 'translateY(' + scrollY + 'em)';
        }, digitIndex * ODO_STAGGER);
      });

      const allDigitsDone = (odoElements.length - 1) * ODO_STAGGER + ODO_DURATION;

      /* ── Phase 4: Show day change ── */
      setTimeout(() => {
        dayChange.classList.add('visible');

        /* ── Phase 5: Fade out + drop blocks ── */
        setTimeout(() => {
          overlayText.classList.add('fading');

          setTimeout(() => {
            overlayText.style.display = 'none';
            overlayBg.style.display   = 'none';

            blockContainer.style.display = '';
            const { blocks, maxDelay, vh, blockH } = buildBlocks();
            blockContainer.offsetHeight;

            blocks.forEach(({ el, delay }) => {
              setTimeout(() => {
                el.style.transition = 'transform ' + BLOCK_DURATION + 'ms cubic-bezier(0.76, 0, 0.24, 1)';
                el.style.transform  = 'translateY(' + (vh + blockH) + 'px)';
              }, delay);
            });

            setTimeout(() => {
              blockContainer.style.display = 'none';
              document.body.style.overflow = '';
              replayBtn.style.display      = '';
            }, maxDelay + BLOCK_DURATION + 100);

          }, TEXT_FADE);
        }, DAY_CHANGE_HOLD);
      }, allDigitsDone + POST_PRICE_HOLD);

    }, odoStart);
  }

  /* ═══════════════════════════════════════════════════ */
  /* Replay                                              */
  /* ═══════════════════════════════════════════════════ */
  replayBtn.addEventListener('click', runAnimation);

  /* ═══════════════════════════════════════════════════ */
  /* Reduced motion                                      */
  /* ═══════════════════════════════════════════════════ */
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    overlayText.style.transition = 'opacity 0.3s ease';
    setTimeout(() => {
      overlayText.style.opacity = '0';
      setTimeout(() => {
        overlayBg.style.display   = 'none';
        overlayText.style.display = 'none';
        document.body.style.overflow = '';
        replayBtn.style.display = '';
      }, 400);
    }, 300);
  } else {
    runAnimation();
  }
})();
</script>
</body>
</html>
